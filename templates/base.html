<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}Escala â€” Sala de Parto{% endblock %}</title>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- CSRF + erros HTMX -->
    <script>
        document.body.addEventListener('htmx:responseError', function (evt) {
            if (evt.detail.xhr.status === 409) {
                alert('Seu tempo de reserva expirou. Recarregue a pÃ¡gina.');
            }
        });

        document.body.addEventListener('htmx:configRequest', function (event) {
            const token = document
                .querySelector('meta[name="csrf-token"]')
                .getAttribute('content');

            event.detail.headers['X-CSRFToken'] = token;
        });
    </script>
</head>

<body class="bg-slate-100 min-h-screen text-slate-800">

<!-- Header -->
<header class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3">

        <h1 class="text-xl font-semibold flex items-center gap-2">
            <a href="{% url 'home' %}">
                ðŸ“… <span>Escala â€” Sala de Parto</span>
            </a>
        </h1>

        {% if request.user.username %}
        <div class="flex items-center gap-4 text-sm">
            <span class="text-slate-600">
                UsuÃ¡rio:
                <strong class="text-slate-800">{{ request.user.username }}</strong>
                <span class="ml-1 px-2 py-0.5 rounded bg-slate-200 text-xs uppercase">
                    {{ request.user.role }}
                </span>
            </span>
        

            <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button
                    type="submit"
                    class="text-red-600 hover:text-red-700 font-medium"
                >
                    Sair
                </button>
            </form>
        </div>
        {% endif %}


    </div>
</header>

<!-- ConteÃºdo -->
<main class="max-w-7xl mx-auto px-4 py-6">

    {% if messages %}
        <div class="mb-4 space-y-2">
            {% for message in messages %}
                <div class="
                    px-4 py-3 rounded
                    {% if message.tags == 'success' %}
                        bg-green-100 text-green-700
                    {% elif message.tags == 'error' %}
                        bg-red-100 text-red-700
                    {% else %}
                        bg-slate-100 text-slate-700
                    {% endif %}
                ">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {% block content %}{% endblock %}
</main>

<!-- Heartbeat do token -->
{% if request.user.is_authenticated and request.user.role != 'CONVIDADO' %}
<div
    hx-get="{% url 'heartbeat_token' %}"
    hx-trigger="every 5m"
    hx-swap="none">
</div>
{% endif %}

</body>
</html>
